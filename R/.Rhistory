get_beta <- function(ticker, index, start_date = Sys.Date() - 365 * 5, end_date = Sys.Date()) {
suppressWarnings(getSymbols(c(index, ticker), from = start_date, to = end_date, env = globalenv()))
xts_beta <- merge(get(index), get(ticker)) %>% na.omit()
df_beta <- xts_beta %>%
as_tibble() %>%
mutate(date = index(xts_beta),
index = get(paste0(index, '.Close')),
ticker = get(paste0(ticker, '.Close'))) %>%
select(date, index, ticker) %>%
mutate(year = year(date),
month = month(date)) %>%
group_by(year, month) %>%
mutate(index_m_ar = index[date == max(date)] / index[date == min(date)] - 1,
ticker_m_ar = ticker[date == max(date)] / ticker[date == min(date)] - 1) %>%
na.fill0(0) %>%
ungroup() %>%
select(year, month, index_m_ar, ticker_m_ar) %>%
unique()
return(lm(ticker_m_ar ~ index_m_ar, data = df_beta)$coefficients[2] %>% unname())
}
get_beta <- function(ticker, index, start_date = Sys.Date() - 365 * 5, end_date = Sys.Date()) {
suppressWarnings(getSymbols(c(index, ticker), from = start_date, to = end_date, env = globalenv()))
xts_beta <- merge(get(index), get(ticker)) %>% na.omit()
df_beta <- xts_beta %>%
as_tibble() %>%
mutate(date = index(xts_beta),
index = get(paste0(index, '.Close')),
ticker = get(paste0(ticker, '.Close'))) %>%
select(date, index, ticker) %>%
mutate(year = year(date),
month = month(date)) %>%
group_by(year, month) %>%
mutate(index_m_ar = index[date == max(date)] / index[date == min(date)] - 1,
ticker_m_ar = ticker[date == max(date)] / ticker[date == min(date)] - 1) %>%
na.fill0(0) %>%
ungroup() %>%
select(year, month, index_m_ar, ticker_m_ar) %>%
unique()
return(lm(ticker_m_ar ~ index_m_ar, data = df_beta)$coefficients[2] %>% unname())
}
source("~/.active-rstudio-document", echo=TRUE)
source("~/.active-rstudio-document", echo=TRUE)
source("~/.active-rstudio-document", echo=TRUE)
get_beta('TSLA', 'GSCP')
get_beta('TSLA', 'GCSP')
get_beta('TSLA', 'GSPC')
get_beta('TSLA', '^GSPC')
get_beta('TSLA', 'GSPC')
View(GSPC)
source("~/.active-rstudio-document", echo=TRUE)
source("~/.active-rstudio-document", echo=TRUE)
source("~/.active-rstudio-document", echo=TRUE)
library(dplyr)
library(zoo)
library(xts)
library(quantmod)
library(lubridate)
get_beta <- function(ticker, index, start_date = Sys.Date() - 365 * 5, end_date = Sys.Date()) {
suppressWarnings(getSymbols(c(index, ticker), from = start_date, to = end_date, env = globalenv()))
xts_beta <- merge(get(index), get(ticker)) %>% na.omit()
df_beta <- xts_beta %>%
as_tibble() %>%
mutate(date = index(xts_beta),
index = get(paste0(index, '.Adjusted')),
ticker = get(paste0(ticker, '.Adjusted'))) %>%
select(date, index, ticker) %>%
mutate(year = year(date),
month = month(date)) %>%
group_by(year, month) %>%
mutate(index_m_ar = index[date == max(date)] / index[date == min(date)] - 1,
ticker_m_ar = ticker[date == max(date)] / ticker[date == min(date)] - 1) %>%
na.fill0(0) %>%
ungroup() %>%
select(year, month, index_m_ar, ticker_m_ar) %>%
unique()
return(lm(ticker_m_ar ~ index_m_ar, data = df_beta)$coefficients[2] %>% unname())
}
source("~/.active-rstudio-document", echo=TRUE)
get_beta('TSLA', '^GSPC')
get_beta('TSLA', 'GSPC')
get_beta('TSLA', 'GSPC')
source("~/.active-rstudio-document", echo=TRUE)
x <- '^GSPC'
y <- gsub('^', '')
y <- gsub(x, '')
?replace
y <- gsub('\\^', '', x)
source("~/.active-rstudio-document", echo=TRUE)
index <- gsub('\\^', '', ine
e)
df_beta <- xts_beta %>%
as_tibble() %>%
mutate(date = index(xts_beta),
index = get(paste0(index, '.Adjusted')),
ticker = get(paste0(ticker, '.Adjusted'))) %>%
select(date, index, ticker) %>%
mutate(year = year(date),
month = month(date)) %>%
group_by(year, month) %>%
mutate(index_m_ar = index[date == max(date)] / index[date == min(date)] - 1,
ticker_m_ar = ticker[date == max(date)] / ticker[date == min(date)] - 1) %>%
na.fill0(0) %>%
ungroup() %>%
select(year, month, index_m_ar, ticker_m_ar) %>%
unique()
source("~/.active-rstudio-document", echo=TRUE)
source("~/.active-rstudio-document", echo=TRUE)
source("~/.active-rstudio-document", echo=TRUE)
cor(GSPC$GSPC.Close, GSPC$GSPC.Adjusted)
cor(GSPC$GSPC.Close, GSPC$GSPC.Adjusted)
source("C:/Users/Kjell/OneDrive/Programming/GitHub/R_Packages/kjell/testing/get_beta_test.R", echo=TRUE)
source("C:/Users/Kjell/OneDrive/Programming/GitHub/R_Packages/kjell/testing/get_beta_test.R", echo=TRUE)
source("C:/Users/Kjell/OneDrive/Programming/GitHub/R_Packages/kjell/testing/get_beta_test.R", echo=TRUE)
source("C:/Users/Kjell/OneDrive/Programming/GitHub/R_Packages/kjell/testing/get_beta_test.R", echo=TRUE)
df_beta <- xts_beta %>%
as_tibble() %>%
mutate(date = index(xts_beta),
index = get(paste0(index, '.Adjusted')),
ticker = get(paste0(ticker, '.Adjusted'))) %>%
select(date, index, ticker) %>%
mutate(year = year(date),
month = month(date)) %>%
group_by(year, month) %>%
mutate(index_m_ar = index[date == max(date)] / index[date == min(date)] - 1,
ticker_m_ar = ticker[date == max(date)] / ticker[date == min(date)] - 1) %>%
na.fill0(0) %>%
ungroup() %>%
select(year, month, index_m_ar, ticker_m_ar) %>%
unique()
xts_beta <- merge(get(index), get(ticker)) %>% na.omit()
ticker <- 'TSLA'
index <- '^GSPC'
suppressWarnings(getSymbols(c(index, ticker), from = start_date, to = end_date, env = globalenv()))
suppressWarnings(getSymbols(c(index, ticker), from = Sys.Date() - 365 * 5, to = Sys.Date(), env = globalenv()))
index <- gsub('\\^', '', index)
xts_beta <- merge(get(index), get(ticker)) %>% na.omit()
df_beta <- xts_beta %>%
as_tibble() %>%
mutate(date = index(xts_beta),
index = get(paste0(index, '.Adjusted')),
ticker = get(paste0(ticker, '.Adjusted'))) %>%
select(date, index, ticker) %>%
mutate(year = year(date),
month = month(date)) %>%
group_by(year, month) %>%
mutate(index_m_ar = index[date == max(date)] / index[date == min(date)] - 1,
ticker_m_ar = ticker[date == max(date)] / ticker[date == min(date)] - 1) %>%
na.fill0(0) %>%
ungroup() %>%
select(year, month, index_m_ar, ticker_m_ar) %>%
unique()
View(df_beta)
suppressWarnings(getSymbols(c(index, ticker), from = Sys.Date() - 365 * 5, to = Sys.Date(), env = globalenv()))
index <- gsub('\\^', '', index)
xts_beta <- merge(get(index), get(ticker)) %>% na.omit()
df_beta <- xts_beta %>%
as_tibble() %>%
mutate(date = index(xts_beta),
index = get(paste0(index, '.Adjusted')),
ticker = get(paste0(ticker, '.Adjusted'))) %>%
select(date, index, ticker) %>%
mutate(year = year(date),
month = month(date)) %>%
group_by(year, month)
View(GSPC)
source("C:/Users/Kjell/OneDrive/Programming/GitHub/R_Packages/kjell/testing/get_beta_test.R", echo=TRUE)
suppressWarnings(getSymbols(c(index, ticker), from = start_date, to = end_date, src = 'yahoo', env = globalenv()))
source("C:/Users/Kjell/OneDrive/Programming/GitHub/R_Packages/kjell/testing/get_beta_test.R", echo=TRUE)
View(df_beta)
source("C:/Users/Kjell/OneDrive/Programming/GitHub/R_Packages/kjell/testing/get_beta_test.R", echo=TRUE)
source("C:/Users/Kjell/OneDrive/Programming/GitHub/R_Packages/kjell/testing/get_beta_test.R", echo=TRUE)
source("C:/Users/Kjell/OneDrive/Programming/GitHub/R_Packages/kjell/testing/get_beta_test.R", echo=TRUE)
lm(ticker_return ~ index_return, data = df_beta)$coefficients[2] %>% unname()
ticker <- 'TSLA'
index <- '^GSPC'
start_date <- '2020-07-01'
end_date <- '2023-09-01'
getSymbols(c(index, ticker), from = start_date, to = end_date, src = 'yahoo', env = globalenv()) %>% suppressWarnings()
index <- gsub('\\^', '', index)
xts_beta <- merge(get(index), get(ticker)) %>% na.omit()
df_beta <- xts_beta %>%
as_tibble() %>%
mutate(date = index(xts_beta),
index = get(paste0(index, '.Adjusted')),
ticker = get(paste0(ticker, '.Adjusted'))) %>%
select(date, index, ticker) %>%
mutate(year = year(date),
month = month(date)) %>%
group_by(year, month) %>%
filter(date == min(date)) %>%
ungroup() %>%
mutate(index_return = (index - dplyr::lag(index)) / dplyr::lag(index),
ticker_return = (ticker - dplyr::lag(ticker)) / dplyr::lag(ticker)) %>%
na.omit()
lm(ticker_return ~ index_return, data = df_beta)$coefficients[2] %>% unname()
ticker <- 'TSLA'
index <- '^GSPC'
start_date <- '2018-07-01'
end_date <- '2023-09-01'
getSymbols(c(index, ticker), from = start_date, to = end_date, src = 'yahoo', env = globalenv()) %>% suppressWarnings()
index <- gsub('\\^', '', index)
xts_beta <- merge(get(index), get(ticker)) %>% na.omit()
df_beta <- xts_beta %>%
as_tibble() %>%
mutate(date = index(xts_beta),
index = get(paste0(index, '.Adjusted')),
ticker = get(paste0(ticker, '.Adjusted'))) %>%
select(date, index, ticker) %>%
mutate(year = year(date),
month = month(date)) %>%
group_by(year, month) %>%
filter(date == min(date)) %>%
ungroup() %>%
mutate(index_return = (index - dplyr::lag(index)) / dplyr::lag(index),
ticker_return = (ticker - dplyr::lag(ticker)) / dplyr::lag(ticker)) %>%
na.omit()
lm(ticker_return ~ index_return, data = df_beta)$coefficients[2] %>% unname()
ticker <- 'TSLA'
index <- '^GSPC'
start_date <- '2018-07-01'
end_date <- '2023-09-01'
getSymbols(c(index, ticker), from = start_date, to = end_date, src = 'yahoo', env = globalenv()) %>% suppressWarnings()
index <- gsub('\\^', '', index)
xts_beta <- merge(get(index), get(ticker)) %>% na.omit()
df_beta <- xts_beta %>%
as_tibble() %>%
mutate(date = index(xts_beta),
index = get(paste0(index, '.Close')),
ticker = get(paste0(ticker, '.Close'))) %>%
select(date, index, ticker) %>%
mutate(year = year(date),
month = month(date)) %>%
group_by(year, month) %>%
filter(date == min(date)) %>%
ungroup() %>%
mutate(index_return = (index - dplyr::lag(index)) / dplyr::lag(index),
ticker_return = (ticker - dplyr::lag(ticker)) / dplyr::lag(ticker)) %>%
na.omit()
lm(ticker_return ~ index_return, data = df_beta)$coefficients[2] %>% unname()
cov(df_beta$ticker, df_beta$index) / var(df_beta$index)
cov(df_beta$ticker, df_beta$index) / var(df_beta$ticker)
cov(df_beta$ticker, df_beta$index) / var(df_beta$index)
source("C:/Users/Kjell/OneDrive/Programming/GitHub/R_Packages/kjell/testing/get_beta_test.R", echo=TRUE)
source("C:/Users/Kjell/OneDrive/Programming/GitHub/R_Packages/kjell/testing/get_beta_test.R", echo=TRUE)
cov(df_beta$index, df_beta$ticker) / var(df_beta$index)
cov(df_beta$ticker, df_beta$index) / var(df_beta$index)
cov(df_beta$ticker, df_beta$index) / var(df_beta$index)
1 + cov(df_beta$ticker, df_beta$index) / var(df_beta$index)
source("C:/Users/Kjell/OneDrive/Programming/GitHub/R_Packages/kjell/testing/get_beta_test.R", echo=TRUE)
lm(ticker_return ~ index_return, data = df_beta)$coefficients[2] %>% unname()
lm(ticker_return ~ index_return, data = df_beta)$coefficients[2] %>% unname()
source("C:/Users/Kjell/OneDrive/Programming/GitHub/R_Packages/kjell/testing/get_beta_test.R", echo=TRUE)
